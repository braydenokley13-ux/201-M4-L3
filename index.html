<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GM Trade Challenge - The 5-Minute Decision Maker</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #ff6b35;
            --secondary: #004e89;
            --accent: #00d4aa;
            --dark: #1a1a2e;
            --darker: #0f0f1a;
            --light: #edf2f4;
            --gold: #ffd700;
            --silver: #c0c0c0;
            --bronze: #cd7f32;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Rajdhani', sans-serif;
            background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 50%, #16213e 100%);
            min-height: 100vh;
            color: var(--light);
            overflow-x: hidden;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .basketball {
            position: absolute;
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, #ff6b35 50%, #e55a2b 50%);
            border-radius: 50%;
            opacity: 0.1;
            animation: float 15s infinite;
        }

        .basketball::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: #333;
            transform: translateY(-50%);
        }

        @keyframes float {
            0%, 100% { transform: translateY(100vh) rotate(0deg); }
            50% { transform: translateY(-100vh) rotate(360deg); }
        }

        /* Main Container */
        .container {
            position: relative;
            z-index: 1;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 30px 0;
        }

        .logo {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5em;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary), var(--gold));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(255, 107, 53, 0.3);
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2em;
            color: var(--accent);
            letter-spacing: 3px;
            text-transform: uppercase;
        }

        /* Game Stats Bar */
        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 40px;
            padding: 20px;
            background: rgba(0, 78, 137, 0.3);
            border-radius: 15px;
            margin: 20px 0;
            border: 1px solid rgba(0, 212, 170, 0.3);
        }

        .stat-item {
            text-align: center;
        }

        .stat-label {
            font-size: 0.9em;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .stat-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 2em;
            font-weight: 700;
            color: var(--light);
        }

        .stat-value.score {
            color: var(--gold);
        }

        /* Timer */
        .timer-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .timer {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5em;
            font-weight: 700;
            color: var(--accent);
            transition: color 0.3s;
        }

        .timer.warning {
            color: var(--primary);
            animation: pulse 0.5s infinite;
        }

        .timer.critical {
            color: #ff4444;
            animation: pulse 0.25s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Level Progress */
        .level-progress {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }

        .level-dot {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 3px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 1.2em;
            transition: all 0.3s;
            position: relative;
        }

        .level-dot.active {
            background: var(--primary);
            border-color: var(--gold);
            box-shadow: 0 0 20px rgba(255, 107, 53, 0.5);
            transform: scale(1.1);
        }

        .level-dot.completed {
            background: var(--accent);
            border-color: var(--accent);
        }

        .level-dot.completed::after {
            content: '‚úì';
            position: absolute;
            font-size: 1.5em;
        }

        .level-dot span {
            display: block;
        }

        .level-dot.completed span {
            display: none;
        }

        /* Scenario Card */
        .scenario-card {
            background: linear-gradient(145deg, rgba(0, 78, 137, 0.5), rgba(26, 26, 46, 0.8));
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            border: 2px solid rgba(0, 212, 170, 0.3);
            position: relative;
            overflow: hidden;
        }

        .scenario-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--accent), var(--gold));
        }

        .scenario-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .team-badge {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .team-logo {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .team-info h2 {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5em;
            color: var(--light);
        }

        .team-info p {
            color: var(--accent);
            font-size: 1.1em;
        }

        .window-badge {
            padding: 10px 25px;
            border-radius: 30px;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 1em;
            text-transform: uppercase;
        }

        .window-rebuild {
            background: linear-gradient(135deg, #4a90d9, #357abd);
            color: white;
        }

        .window-push {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }

        .window-title {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .scenario-description {
            font-size: 1.2em;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.9);
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            border-left: 4px solid var(--accent);
        }

        .pick-display {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--gold);
            color: var(--darker);
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 700;
            margin: 10px 5px;
        }

        /* Trade Options */
        .trades-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .trade-card {
            background: linear-gradient(145deg, rgba(26, 26, 46, 0.9), rgba(15, 15, 26, 0.95));
            border-radius: 15px;
            padding: 25px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .trade-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent);
            box-shadow: 0 10px 30px rgba(0, 212, 170, 0.2);
        }

        .trade-card.selected {
            border-color: var(--gold);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.4);
            transform: scale(1.02);
        }

        .trade-card.selected::before {
            content: '‚úì SELECTED';
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--gold);
            color: var(--darker);
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.8em;
        }

        .trade-type {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.3em;
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .trade-type-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
        }

        .trade-up .trade-type-icon {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
        }

        .trade-down .trade-type-icon {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }

        .keep .trade-type-icon {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        }

        .vet-trade .trade-type-icon {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
        }

        .star-trade .trade-type-icon {
            background: linear-gradient(135deg, #f1c40f, #f39c12);
        }

        .trade-description {
            font-size: 1.05em;
            line-height: 1.5;
            color: rgba(255, 255, 255, 0.85);
            margin-bottom: 20px;
            min-height: 60px;
        }

        .player-name {
            color: var(--gold);
            font-weight: 700;
        }

        .trade-scores {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .score-box {
            text-align: center;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }

        .score-label {
            font-size: 0.75em;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }

        .score-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5em;
            font-weight: 700;
        }

        .score-value.positive {
            color: #2ecc71;
        }

        .score-value.negative {
            color: #e74c3c;
        }

        .score-value.neutral {
            color: var(--light);
        }

        /* Hidden scores for hard mode */
        .hidden-scores .score-value {
            filter: blur(8px);
            user-select: none;
        }

        .hidden-scores .score-box::after {
            content: '?';
            position: absolute;
            font-size: 1.5em;
            color: var(--accent);
        }

        /* Buttons */
        .btn {
            font-family: 'Rajdhani', sans-serif;
            font-size: 1.2em;
            font-weight: 700;
            padding: 15px 40px;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), #e55a2b);
            color: white;
            box-shadow: 0 5px 20px rgba(255, 107, 53, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(255, 107, 53, 0.6);
        }

        .btn-primary:disabled {
            background: #666;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        .btn-secondary {
            background: transparent;
            border: 2px solid var(--accent);
            color: var(--accent);
        }

        .btn-secondary:hover {
            background: var(--accent);
            color: var(--darker);
        }

        .btn-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        /* Results Screen */
        .results-screen {
            text-align: center;
            padding: 40px;
        }

        .result-grade {
            font-family: 'Orbitron', sans-serif;
            font-size: 6em;
            font-weight: 900;
            margin: 20px 0;
            text-shadow: 0 0 50px currentColor;
        }

        .grade-s { color: var(--gold); }
        .grade-a { color: #2ecc71; }
        .grade-b { color: #3498db; }
        .grade-c { color: #f39c12; }
        .grade-f { color: #e74c3c; }

        .result-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .breakdown-item {
            background: rgba(0, 78, 137, 0.3);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(0, 212, 170, 0.3);
        }

        .breakdown-label {
            color: var(--accent);
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .breakdown-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 2em;
            font-weight: 700;
            margin-top: 10px;
        }

        /* Claim Code */
        .claim-code-container {
            background: linear-gradient(145deg, rgba(255, 215, 0, 0.2), rgba(255, 107, 53, 0.2));
            border: 3px solid var(--gold);
            border-radius: 20px;
            padding: 30px;
            margin: 30px auto;
            max-width: 500px;
        }

        .claim-code-label {
            color: var(--gold);
            font-size: 1.2em;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 15px;
        }

        .claim-code {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5em;
            font-weight: 900;
            color: var(--light);
            letter-spacing: 5px;
            padding: 15px 30px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            display: inline-block;
            cursor: pointer;
            transition: all 0.3s;
        }

        .claim-code:hover {
            background: rgba(255, 215, 0, 0.2);
        }

        .copy-hint {
            font-size: 0.9em;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 10px;
        }

        /* Start Screen */
        .start-screen {
            text-align: center;
            padding: 60px 20px;
        }

        .game-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 3em;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary), var(--gold), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            line-height: 1.2;
        }

        .game-intro {
            font-size: 1.3em;
            color: rgba(255, 255, 255, 0.8);
            max-width: 700px;
            margin: 0 auto 40px;
            line-height: 1.8;
        }

        .difficulty-select {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin: 40px 0;
        }

        .difficulty-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5em;
            color: var(--accent);
            margin-bottom: 10px;
        }

        .level-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            width: 100%;
            max-width: 1000px;
        }

        .level-card {
            background: linear-gradient(145deg, rgba(26, 26, 46, 0.9), rgba(15, 15, 26, 0.95));
            border-radius: 20px;
            padding: 30px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .level-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }

        .level-card.rookie {
            border-color: var(--bronze);
        }

        .level-card.rookie:hover {
            box-shadow: 0 20px 40px rgba(205, 127, 50, 0.3);
        }

        .level-card.veteran {
            border-color: var(--silver);
        }

        .level-card.veteran:hover {
            box-shadow: 0 20px 40px rgba(192, 192, 192, 0.3);
        }

        .level-card.champion {
            border-color: var(--gold);
        }

        .level-card.champion:hover {
            box-shadow: 0 20px 40px rgba(255, 215, 0, 0.3);
        }

        .level-card-icon {
            font-size: 4em;
            margin-bottom: 15px;
        }

        .level-card-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5em;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .level-card-desc {
            color: rgba(255, 255, 255, 0.7);
            font-size: 1em;
            line-height: 1.5;
            margin-bottom: 20px;
        }

        .level-card-features {
            text-align: left;
            font-size: 0.9em;
        }

        .level-card-features li {
            margin: 8px 0;
            color: rgba(255, 255, 255, 0.8);
        }

        .locked-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            border-radius: 18px;
        }

        .locked-overlay span {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .locked-text {
            font-family: 'Orbitron', sans-serif;
            color: var(--light);
        }

        /* Confetti */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            top: -10px;
            animation: confetti-fall 3s linear forwards;
        }

        @keyframes confetti-fall {
            to {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        /* Tutorial Tooltip */
        .tooltip {
            position: absolute;
            background: var(--accent);
            color: var(--darker);
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: 600;
            z-index: 100;
            animation: bounce 1s infinite;
        }

        .tooltip::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: var(--accent);
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .logo {
                font-size: 1.8em;
            }

            .game-title {
                font-size: 2em;
            }

            .stats-bar {
                flex-wrap: wrap;
                gap: 20px;
            }

            .scenario-header {
                flex-direction: column;
                text-align: center;
            }

            .team-badge {
                flex-direction: column;
            }

            .trades-grid {
                grid-template-columns: 1fr;
            }

            .trade-scores {
                grid-template-columns: repeat(3, 1fr);
            }

            .result-grade {
                font-size: 4em;
            }

            .claim-code {
                font-size: 1.5em;
                letter-spacing: 3px;
            }
        }

        /* Animations */
        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide-in {
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-50px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* Hidden class */
        .hidden {
            display: none !important;
        }

        /* Feedback message */
        .feedback-message {
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            font-size: 1.1em;
            line-height: 1.6;
        }

        .feedback-good {
            background: rgba(46, 204, 113, 0.2);
            border: 2px solid #2ecc71;
        }

        .feedback-okay {
            background: rgba(243, 156, 18, 0.2);
            border: 2px solid #f39c12;
        }

        .feedback-bad {
            background: rgba(231, 76, 60, 0.2);
            border: 2px solid #e74c3c;
        }

        /* Sound toggle */
        .sound-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.5em;
            z-index: 1000;
            transition: all 0.3s;
        }

        .sound-toggle:hover {
            background: rgba(0, 212, 170, 0.3);
            border-color: var(--accent);
        }

        /* Progress bar for round */
        .round-progress {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .round-dot {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transition: all 0.3s;
        }

        .round-dot.active {
            background: var(--accent);
            box-shadow: 0 0 10px var(--accent);
        }

        .round-dot.completed {
            background: var(--gold);
        }
    </style>
</head>
<body>
    <!-- Background Animation -->
    <div class="bg-animation" id="bgAnimation"></div>

    <!-- Sound Toggle -->
    <button class="sound-toggle" id="soundToggle" title="Toggle Sound">üîä</button>

    <!-- Main Container -->
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1 class="logo">GM TRADE CHALLENGE</h1>
            <p class="subtitle">The 5-Minute Decision Maker</p>
        </header>

        <!-- Game Content -->
        <main id="gameContent">
            <!-- Start Screen -->
            <div id="startScreen" class="start-screen fade-in">
                <h2 class="game-title">Are You Ready to Run an NBA Franchise?</h2>
                <p class="game-intro">
                    Step into the GM's office and make critical draft-day trade decisions.
                    Each choice shapes your team's future. Will you build for tomorrow,
                    push for playoffs, or go all-in for a championship?
                    <strong>Your legacy starts now.</strong>
                </p>

                <div class="difficulty-select">
                    <h3 class="difficulty-title">Select Your Challenge Level</h3>
                    <div class="level-cards">
                        <!-- Level 1: Rookie GM -->
                        <div class="level-card rookie" onclick="startGame(1)" id="level1Card">
                            <div class="level-card-icon">üèÄ</div>
                            <h4 class="level-card-title" style="color: var(--bronze)">ROOKIE GM</h4>
                            <p class="level-card-desc">Learn the ropes with clear guidance and forgiving timers.</p>
                            <ul class="level-card-features">
                                <li>‚úÖ Full score visibility</li>
                                <li>‚úÖ 90 second timer per round</li>
                                <li>‚úÖ Detailed trade explanations</li>
                                <li>‚úÖ Rebuilding team scenario</li>
                            </ul>
                        </div>

                        <!-- Level 2: Veteran GM -->
                        <div class="level-card veteran" onclick="startGame(2)" id="level2Card">
                            <div class="level-card-icon">‚≠ê</div>
                            <h4 class="level-card-title" style="color: var(--silver)">VETERAN GM</h4>
                            <p class="level-card-desc">Prove your skills with tighter deadlines and hidden metrics.</p>
                            <ul class="level-card-features">
                                <li>‚ö° Partial score visibility</li>
                                <li>‚ö° 60 second timer per round</li>
                                <li>‚ö° Playoff push scenario</li>
                                <li>‚ö° Requires Level 1 completion</li>
                            </ul>
                            <div class="locked-overlay hidden" id="level2Lock">
                                <span>üîí</span>
                                <p class="locked-text">Complete Rookie GM First</p>
                            </div>
                        </div>

                        <!-- Level 3: Championship GM -->
                        <div class="level-card champion" onclick="startGame(3)" id="level3Card">
                            <div class="level-card-icon">üèÜ</div>
                            <h4 class="level-card-title" style="color: var(--gold)">CHAMPIONSHIP GM</h4>
                            <p class="level-card-desc">Win-now mode. One shot at glory. No second chances.</p>
                            <ul class="level-card-features">
                                <li>üî• Hidden scores revealed after</li>
                                <li>üî• 45 second timer per round</li>
                                <li>üî• Title contender scenario</li>
                                <li>üî• Requires Level 2 completion</li>
                            </ul>
                            <div class="locked-overlay hidden" id="level3Lock">
                                <span>üîí</span>
                                <p class="locked-text">Complete Veteran GM First</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Game Screen -->
            <div id="gameScreen" class="hidden">
                <!-- Stats Bar -->
                <div class="stats-bar">
                    <div class="stat-item">
                        <div class="stat-label">Level</div>
                        <div class="stat-value" id="levelDisplay">1</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Round</div>
                        <div class="stat-value" id="roundDisplay">1/3</div>
                    </div>
                    <div class="stat-item timer-container">
                        <div class="stat-label">Time</div>
                        <div class="timer" id="timerDisplay">90</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Score</div>
                        <div class="stat-value score" id="scoreDisplay">0</div>
                    </div>
                </div>

                <!-- Level Progress -->
                <div class="level-progress">
                    <div class="level-dot" id="levelDot1"><span>1</span></div>
                    <div class="level-dot" id="levelDot2"><span>2</span></div>
                    <div class="level-dot" id="levelDot3"><span>3</span></div>
                </div>

                <!-- Round Progress -->
                <div class="round-progress" id="roundProgress">
                    <div class="round-dot" id="roundDot1"></div>
                    <div class="round-dot" id="roundDot2"></div>
                    <div class="round-dot" id="roundDot3"></div>
                </div>

                <!-- Scenario Card -->
                <div class="scenario-card fade-in" id="scenarioCard">
                    <div class="scenario-header">
                        <div class="team-badge">
                            <div class="team-logo" id="teamLogo">üèÄ</div>
                            <div class="team-info">
                                <h2 id="teamName">Phoenix Rising</h2>
                                <p id="teamRecord">Record: 25-57</p>
                            </div>
                        </div>
                        <div class="window-badge window-rebuild" id="windowBadge">4-Year Rebuild</div>
                    </div>
                    <div class="scenario-description" id="scenarioDesc">
                        You're the GM of a rebuilding franchise. Your owner wants to see progress,
                        but understands championships aren't built overnight. You own
                        <span class="pick-display">üéØ Pick #8</span> in tonight's draft.
                        Make a move that sets up your future.
                    </div>
                </div>

                <!-- Trade Options -->
                <div class="trades-grid" id="tradesGrid">
                    <!-- Trade cards will be dynamically generated -->
                </div>

                <!-- Confirm Button -->
                <div class="btn-container">
                    <button class="btn btn-primary" id="confirmBtn" disabled onclick="confirmTrade()">
                        Select a Trade to Continue
                    </button>
                </div>
            </div>

            <!-- Results Screen -->
            <div id="resultsScreen" class="results-screen hidden">
                <h2 id="resultsTitle">Level Complete!</h2>
                <div class="result-grade" id="resultGrade">A</div>
                <p id="resultsMessage" style="font-size: 1.3em; margin-bottom: 20px;"></p>

                <div class="result-breakdown" id="resultBreakdown">
                    <!-- Breakdown items will be dynamically generated -->
                </div>

                <div id="feedbackContainer"></div>

                <div class="claim-code-container" id="claimCodeContainer">
                    <div class="claim-code-label">üéâ Your Claim Code</div>
                    <div class="claim-code" id="claimCode" onclick="copyClaimCode()">LOADING...</div>
                    <p class="copy-hint">Click to copy</p>
                </div>

                <div class="btn-container">
                    <button class="btn btn-secondary" onclick="showStartScreen()">Back to Menu</button>
                    <button class="btn btn-primary" id="nextLevelBtn" onclick="goToNextLevel()">Next Level ‚Üí</button>
                </div>
            </div>
        </main>
    </div>

    <script>
        // ==================== GAME DATA ====================
        const gameData = {
            levels: {
                1: {
                    name: "Rookie GM",
                    timer: 90,
                    showScores: true,
                    passScore: 4,
                    claimCode: "ROOKIE-GM-2024",
                    scenarios: [
                        {
                            round: 1,
                            team: "Phoenix Rising",
                            logo: "üî•",
                            record: "25-57 (Lottery Team)",
                            window: "4-Year Rebuild",
                            windowClass: "window-rebuild",
                            pick: 8,
                            description: "You've just taken over a rebuilding franchise with young talent but no stars. The owner is patient but expects smart moves. Tonight you hold <span class='pick-display'>üéØ Pick #8</span>. Build for the future wisely.",
                            trades: [
                                {
                                    type: "Trade Up",
                                    typeClass: "trade-up",
                                    icon: "‚¨ÜÔ∏è",
                                    description: "Move up to <strong>Pick #5</strong> by sending Pick #8 + two future 2nd round picks. Target the franchise cornerstone.",
                                    player: null,
                                    ev: 2, surplus: 1, windowFit: 0
                                },
                                {
                                    type: "Trade Down",
                                    typeClass: "trade-down",
                                    icon: "‚¨áÔ∏è",
                                    description: "Receive <strong>Pick #15 + Pick #34</strong> for your #8. Stockpile assets for the long haul.",
                                    player: null,
                                    ev: 1, surplus: 2, windowFit: 0
                                },
                                {
                                    type: "Stay Put",
                                    typeClass: "keep",
                                    icon: "‚úã",
                                    description: "Keep <strong>Pick #8</strong> and draft the best player available. Sometimes patience pays.",
                                    player: null,
                                    ev: 1, surplus: 1, windowFit: 0
                                },
                                {
                                    type: "Vet Trade",
                                    typeClass: "vet-trade",
                                    icon: "üë§",
                                    description: "Acquire <span class='player-name'>Darius Flint</span> (27-year-old starter wing) for Pick #8. Instant contributor, declining asset.",
                                    player: "Darius Flint",
                                    ev: 1, surplus: 0, windowFit: 3
                                },
                                {
                                    type: "Star Swing",
                                    typeClass: "star-trade",
                                    icon: "‚≠ê",
                                    description: "Land near All-Star <span class='player-name'>Kyree Dalton</span> (30) by sending Pick #8 + unprotected 2028 1st. Big risk, big reward.",
                                    player: "Kyree Dalton",
                                    ev: 1, surplus: -2, windowFit: 3
                                }
                            ]
                        },
                        {
                            round: 2,
                            team: "Denver Altitude",
                            logo: "üèîÔ∏è",
                            record: "38-44 (Play-In Team)",
                            window: "2-Year Push",
                            windowClass: "window-push",
                            pick: 12,
                            description: "Your team just missed the playoffs. The core is entering their prime, and the window is opening. You own <span class='pick-display'>üéØ Pick #12</span>. Time to accelerate.",
                            trades: [
                                {
                                    type: "Trade Up",
                                    typeClass: "trade-up",
                                    icon: "‚¨ÜÔ∏è",
                                    description: "Move to <strong>Pick #7</strong> by packaging Pick #12 + Pick #40. Target a higher-ceiling prospect.",
                                    player: null,
                                    ev: 2, surplus: 1, windowFit: 1
                                },
                                {
                                    type: "Trade Down",
                                    typeClass: "trade-down",
                                    icon: "‚¨áÔ∏è",
                                    description: "Get <strong>Pick #20 + a 2027 top-20 protected 1st</strong> for Pick #12. Flexibility for the future.",
                                    player: null,
                                    ev: 2, surplus: 2, windowFit: 1
                                },
                                {
                                    type: "Stay Put",
                                    typeClass: "keep",
                                    icon: "‚úã",
                                    description: "Keep <strong>Pick #12</strong> and add young talent to your rising core.",
                                    player: null,
                                    ev: 1, surplus: 2, windowFit: 0
                                },
                                {
                                    type: "Vet Trade",
                                    typeClass: "vet-trade",
                                    icon: "üë§",
                                    description: "Acquire <span class='player-name'>Miles Harrow</span> (31-year-old stretch big) for Pick #12. Fills a need but aging fast.",
                                    player: "Miles Harrow",
                                    ev: 1, surplus: -1, windowFit: 1
                                },
                                {
                                    type: "Star Swing",
                                    typeClass: "star-trade",
                                    icon: "‚≠ê",
                                    description: "Land borderline All-Star <span class='player-name'>Trey Rollins</span> (25) for Pick #12 + two 2nds. Young star to push you over the top.",
                                    player: "Trey Rollins",
                                    ev: 3, surplus: 1, windowFit: 0
                                }
                            ]
                        },
                        {
                            round: 3,
                            team: "Miami Heat Wave",
                            logo: "üå¥",
                            record: "52-30 (Title Contender)",
                            window: "1-Year Title Window",
                            windowClass: "window-title",
                            pick: 16,
                            description: "Championship or bust. Your superstar is 32 and in his prime. This is THE year. You have <span class='pick-display'>üéØ Pick #16</span> (from a trade). Make it count.",
                            trades: [
                                {
                                    type: "Trade Up",
                                    typeClass: "trade-up",
                                    icon: "‚¨ÜÔ∏è",
                                    description: "Move to <strong>Pick #10</strong> by adding Pick #42. Get a better prospect to develop.",
                                    player: null,
                                    ev: 1, surplus: 1, windowFit: 2
                                },
                                {
                                    type: "Trade Down",
                                    typeClass: "trade-down",
                                    icon: "‚¨áÔ∏è",
                                    description: "Get <strong>Pick #24 + rotation big Reese Morrow</strong>. Add depth for the playoff run.",
                                    player: "Reese Morrow",
                                    ev: 2, surplus: 0, windowFit: 0
                                },
                                {
                                    type: "Stay Put",
                                    typeClass: "keep",
                                    icon: "‚úã",
                                    description: "Keep <strong>Pick #16</strong> for a lottery ticket. Maybe find a rotation piece.",
                                    player: null,
                                    ev: 0, surplus: 1, windowFit: 3
                                },
                                {
                                    type: "Vet Trade",
                                    typeClass: "vet-trade",
                                    icon: "üë§",
                                    description: "Acquire <span class='player-name'>Victor Hale</span> (30-year-old starter guard, $12M/2yr) for Pick #16. Proven playoff performer.",
                                    player: "Victor Hale",
                                    ev: 3, surplus: 2, windowFit: 0
                                },
                                {
                                    type: "Star Swing",
                                    typeClass: "star-trade",
                                    icon: "‚≠ê",
                                    description: "Land star forward <span class='player-name'>Landon Cruz</span> for Pick #16 + future 1st + young player. Go all-in for the chip.",
                                    player: "Landon Cruz",
                                    ev: 5, surplus: -2, windowFit: 0
                                }
                            ]
                        }
                    ]
                },
                2: {
                    name: "Veteran GM",
                    timer: 60,
                    showScores: "partial", // Only show EV
                    passScore: 6,
                    claimCode: "VETERAN-GM-PRO",
                    scenarios: [
                        {
                            round: 1,
                            team: "Seattle Storm",
                            logo: "‚õàÔ∏è",
                            record: "28-54 (Rebuilding)",
                            window: "3-Year Rebuild",
                            windowClass: "window-rebuild",
                            pick: 6,
                            description: "New city, new franchise. Seattle is basketball-crazy and expects a winner within 3 years. You own <span class='pick-display'>üéØ Pick #6</span>. The pressure is real.",
                            trades: [
                                {
                                    type: "Trade Up",
                                    typeClass: "trade-up",
                                    icon: "‚¨ÜÔ∏è",
                                    description: "Move to <strong>Pick #2</strong> for Pick #6 + Pick #18 + 2027 unprotected 1st. Secure a generational talent?",
                                    player: null,
                                    ev: 3, surplus: 0, windowFit: 0
                                },
                                {
                                    type: "Trade Down",
                                    typeClass: "trade-down",
                                    icon: "‚¨áÔ∏è",
                                    description: "Receive <strong>Pick #11 + Pick #19 + Pick #38</strong>. Three bites at the apple.",
                                    player: null,
                                    ev: 2, surplus: 3, windowFit: 0
                                },
                                {
                                    type: "Stay Put",
                                    typeClass: "keep",
                                    icon: "‚úã",
                                    description: "Keep <strong>Pick #6</strong>. Several potential All-Stars projected here.",
                                    player: null,
                                    ev: 2, surplus: 1, windowFit: 0
                                },
                                {
                                    type: "Vet Trade",
                                    typeClass: "vet-trade",
                                    icon: "üë§",
                                    description: "Acquire <span class='player-name'>Marcus Webb</span> (28, $18M/yr starting PG) for Pick #6. Instant face of franchise.",
                                    player: "Marcus Webb",
                                    ev: 2, surplus: -1, windowFit: 2
                                },
                                {
                                    type: "Star Swing",
                                    typeClass: "star-trade",
                                    icon: "‚≠ê",
                                    description: "Land All-Star <span class='player-name'>DeShawn Mitchell</span> (29) for Pick #6 + two future 1sts. Accelerate the timeline massively.",
                                    player: "DeShawn Mitchell",
                                    ev: 2, surplus: -3, windowFit: 3
                                }
                            ]
                        },
                        {
                            round: 2,
                            team: "Toronto Raptors",
                            logo: "ü¶ñ",
                            record: "41-41 (Bubble Team)",
                            window: "Win-Now Push",
                            windowClass: "window-push",
                            pick: 14,
                            description: "The core is locked in and ready to compete. International scouting has found gems before. You hold <span class='pick-display'>üéØ Pick #14</span>. Make it matter.",
                            trades: [
                                {
                                    type: "Trade Up",
                                    typeClass: "trade-up",
                                    icon: "‚¨ÜÔ∏è",
                                    description: "Jump to <strong>Pick #8</strong> for Pick #14 + Pick #45 + future 2nd. Secure your guy.",
                                    player: null,
                                    ev: 2, surplus: 1, windowFit: 1
                                },
                                {
                                    type: "Trade Down",
                                    typeClass: "trade-down",
                                    icon: "‚¨áÔ∏è",
                                    description: "Get <strong>Pick #22 + Pick #28 + expiring $8M contract</strong>. Two picks + cap space.",
                                    player: null,
                                    ev: 1, surplus: 2, windowFit: 0
                                },
                                {
                                    type: "Stay Put",
                                    typeClass: "keep",
                                    icon: "‚úã",
                                    description: "Keep <strong>Pick #14</strong>. Trust the scouting department.",
                                    player: null,
                                    ev: 1, surplus: 1, windowFit: 0
                                },
                                {
                                    type: "Vet Trade",
                                    typeClass: "vet-trade",
                                    icon: "üë§",
                                    description: "Acquire <span class='player-name'>Chris Aldridge</span> (29, elite 3&D wing) for Pick #14. Perfect roster fit.",
                                    player: "Chris Aldridge",
                                    ev: 2, surplus: 1, windowFit: 0
                                },
                                {
                                    type: "Star Swing",
                                    typeClass: "star-trade",
                                    icon: "‚≠ê",
                                    description: "Land <span class='player-name'>Jaylen Monroe</span> (26 All-Star PG) for Pick #14 + starter + 2028 1st. Championship piece.",
                                    player: "Jaylen Monroe",
                                    ev: 4, surplus: 0, windowFit: 0
                                }
                            ]
                        },
                        {
                            round: 3,
                            team: "Golden State Legacy",
                            logo: "üåâ",
                            record: "49-33 (Contender)",
                            window: "Final Championship Window",
                            windowClass: "window-title",
                            pick: 18,
                            description: "The dynasty's last dance. Your legends are 35+. The window closes after this year. You have <span class='pick-display'>üéØ Pick #18</span>. Ring or regret.",
                            trades: [
                                {
                                    type: "Trade Up",
                                    typeClass: "trade-up",
                                    icon: "‚¨ÜÔ∏è",
                                    description: "Move to <strong>Pick #12</strong> for Pick #18 + young rotation player. One last lottery swing.",
                                    player: null,
                                    ev: 1, surplus: 0, windowFit: 2
                                },
                                {
                                    type: "Trade Down",
                                    typeClass: "trade-down",
                                    icon: "‚¨áÔ∏è",
                                    description: "Get <strong>Pick #25 + Pick #32 + playoff veteran</strong>. Depth for the run.",
                                    player: null,
                                    ev: 2, surplus: 1, windowFit: 0
                                },
                                {
                                    type: "Stay Put",
                                    typeClass: "keep",
                                    icon: "‚úã",
                                    description: "Keep <strong>Pick #18</strong>. Maybe find the next late-round gem.",
                                    player: null,
                                    ev: 0, surplus: 1, windowFit: 3
                                },
                                {
                                    type: "Vet Trade",
                                    typeClass: "vet-trade",
                                    icon: "üë§",
                                    description: "Acquire <span class='player-name'>Andre Thompson</span> (32, championship PF, $15M) for Pick #18. Been there, done that.",
                                    player: "Andre Thompson",
                                    ev: 3, surplus: 1, windowFit: 0
                                },
                                {
                                    type: "Star Swing",
                                    typeClass: "star-trade",
                                    icon: "‚≠ê",
                                    description: "Land <span class='player-name'>Brandon Cole</span> (28 All-NBA) for Pick #18 + two 1sts + young star. Mortage everything for glory.",
                                    player: "Brandon Cole",
                                    ev: 5, surplus: -2, windowFit: 0
                                }
                            ]
                        }
                    ]
                },
                3: {
                    name: "Championship GM",
                    timer: 45,
                    showScores: false,
                    passScore: 8,
                    claimCode: "CHAMP-GM-ELITE",
                    scenarios: [
                        {
                            round: 1,
                            team: "Oklahoma Thunder",
                            logo: "‚ö°",
                            record: "22-60 (Tank Commander)",
                            window: "5-Year Dynasty Build",
                            windowClass: "window-rebuild",
                            pick: 3,
                            description: "You have ALL the picks. The tank worked. Now it's time to build a dynasty. You own <span class='pick-display'>üéØ Pick #3</span> with five more 1sts over 3 years. Legacy defining.",
                            trades: [
                                {
                                    type: "Trade Up",
                                    typeClass: "trade-up",
                                    icon: "‚¨ÜÔ∏è",
                                    description: "Move to <strong>Pick #1</strong> for Pick #3 + Pick #12 + 2027 1st. Secure the generational prospect.",
                                    player: null,
                                    ev: 4, surplus: 0, windowFit: 0
                                },
                                {
                                    type: "Trade Down",
                                    typeClass: "trade-down",
                                    icon: "‚¨áÔ∏è",
                                    description: "Receive <strong>Pick #7 + Pick #9 + Pick #15</strong>. Three potential starters.",
                                    player: null,
                                    ev: 3, surplus: 4, windowFit: 0
                                },
                                {
                                    type: "Stay Put",
                                    typeClass: "keep",
                                    icon: "‚úã",
                                    description: "Keep <strong>Pick #3</strong>. Top 3 picks are franchise-changers.",
                                    player: null,
                                    ev: 3, surplus: 2, windowFit: 0
                                },
                                {
                                    type: "Vet Trade",
                                    typeClass: "vet-trade",
                                    icon: "üë§",
                                    description: "Acquire <span class='player-name'>Kevin Nash Jr.</span> (26, rising star SF) for Pick #3. Known commodity vs. unknown.",
                                    player: "Kevin Nash Jr.",
                                    ev: 2, surplus: 1, windowFit: 2
                                },
                                {
                                    type: "Star Swing",
                                    typeClass: "star-trade",
                                    icon: "‚≠ê",
                                    description: "Land MVP candidate <span class='player-name'>Zion Williams</span> (25) for Pick #3 + three future 1sts. Instant contender.",
                                    player: "Zion Williams",
                                    ev: 3, surplus: -2, windowFit: 4
                                }
                            ]
                        },
                        {
                            round: 2,
                            team: "Milwaukee Dynasty",
                            logo: "ü¶å",
                            record: "54-28 (Top Seed)",
                            window: "3-Year Championship Window",
                            windowClass: "window-push",
                            pick: 21,
                            description: "Back-to-back Finals appearances. Your superstar duo is locked in for 3 more years. You have <span class='pick-display'>üéØ Pick #21</span>. Add the final piece.",
                            trades: [
                                {
                                    type: "Trade Up",
                                    typeClass: "trade-up",
                                    icon: "‚¨ÜÔ∏è",
                                    description: "Jump to <strong>Pick #14</strong> for Pick #21 + rotation guard + 2nd. Upgrade prospect quality.",
                                    player: null,
                                    ev: 2, surplus: 0, windowFit: 1
                                },
                                {
                                    type: "Trade Down",
                                    typeClass: "trade-down",
                                    icon: "‚¨áÔ∏è",
                                    description: "Get <strong>Pick #26 + Pick #35 + $5M trade exception</strong>. Flexibility.",
                                    player: null,
                                    ev: 1, surplus: 2, windowFit: 0
                                },
                                {
                                    type: "Stay Put",
                                    typeClass: "keep",
                                    icon: "‚úã",
                                    description: "Keep <strong>Pick #21</strong>. Find a contributor on a rookie deal.",
                                    player: null,
                                    ev: 1, surplus: 1, windowFit: 0
                                },
                                {
                                    type: "Vet Trade",
                                    typeClass: "vet-trade",
                                    icon: "üë§",
                                    description: "Acquire <span class='player-name'>Patrick Beverly Jr.</span> (30, elite defender) for Pick #21. Dawg mentality.",
                                    player: "Patrick Beverly Jr.",
                                    ev: 2, surplus: 0, windowFit: 0
                                },
                                {
                                    type: "Star Swing",
                                    typeClass: "star-trade",
                                    icon: "‚≠ê",
                                    description: "Land <span class='player-name'>Damian Lillard II</span> (27 All-Star PG) for Pick #21 + starter + 2 1sts. Big 3 formed.",
                                    player: "Damian Lillard II",
                                    ev: 4, surplus: -1, windowFit: 0
                                }
                            ]
                        },
                        {
                            round: 3,
                            team: "Boston Legends",
                            logo: "‚òòÔ∏è",
                            record: "57-25 (Best Record)",
                            window: "THIS IS THE YEAR",
                            windowClass: "window-title",
                            pick: 28,
                            description: "Best team in the league. Banner 19 is within reach. Key players are free agents next summer. You have <span class='pick-display'>üéØ Pick #28</span>. No tomorrow. Only now.",
                            trades: [
                                {
                                    type: "Trade Up",
                                    typeClass: "trade-up",
                                    icon: "‚¨ÜÔ∏è",
                                    description: "Move to <strong>Pick #20</strong> for Pick #28 + future 2nd + cash. Marginal upgrade.",
                                    player: null,
                                    ev: 1, surplus: 0, windowFit: 2
                                },
                                {
                                    type: "Trade Down",
                                    typeClass: "trade-down",
                                    icon: "‚¨áÔ∏è",
                                    description: "Get <strong>Pick #33 + Pick #40 + rotation player</strong>. Add playoff-ready depth.",
                                    player: null,
                                    ev: 2, surplus: 1, windowFit: 0
                                },
                                {
                                    type: "Stay Put",
                                    typeClass: "keep",
                                    icon: "‚úã",
                                    description: "Keep <strong>Pick #28</strong>. Stash a prospect, focus on buyout market.",
                                    player: null,
                                    ev: 0, surplus: 1, windowFit: 4
                                },
                                {
                                    type: "Vet Trade",
                                    typeClass: "vet-trade",
                                    icon: "üë§",
                                    description: "Acquire <span class='player-name'>PJ Tucker III</span> (33, corner 3 specialist, playoff vet) for Pick #28. Championship DNA.",
                                    player: "PJ Tucker III",
                                    ev: 2, surplus: 1, windowFit: 0
                                },
                                {
                                    type: "Star Swing",
                                    typeClass: "star-trade",
                                    icon: "‚≠ê",
                                    description: "Land <span class='player-name'>Anthony Edwards Jr.</span> (26, top-10 player) for Pick #28 + 3 1sts + 2 starters. ULTIMATE ALL-IN.",
                                    player: "Anthony Edwards Jr.",
                                    ev: 6, surplus: -3, windowFit: 0
                                }
                            ]
                        }
                    ]
                }
            }
        };

        // ==================== GAME STATE ====================
        let state = {
            currentLevel: 1,
            currentRound: 0,
            score: 0,
            totalEV: 0,
            totalSurplus: 0,
            totalWindowFit: 0,
            timer: 90,
            timerInterval: null,
            selectedTrade: null,
            completedLevels: JSON.parse(localStorage.getItem('completedLevels')) || [],
            soundEnabled: true,
            roundScores: []
        };

        // ==================== AUDIO ====================
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx = null;

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new AudioContext();
            }
        }

        function playSound(type) {
            if (!state.soundEnabled || !audioCtx) return;

            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            switch(type) {
                case 'select':
                    oscillator.frequency.value = 440;
                    oscillator.type = 'sine';
                    gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                    oscillator.start(audioCtx.currentTime);
                    oscillator.stop(audioCtx.currentTime + 0.1);
                    break;
                case 'confirm':
                    oscillator.frequency.value = 523.25;
                    oscillator.type = 'sine';
                    gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
                    oscillator.start(audioCtx.currentTime);
                    oscillator.stop(audioCtx.currentTime + 0.2);
                    break;
                case 'tick':
                    oscillator.frequency.value = 800;
                    oscillator.type = 'square';
                    gainNode.gain.setValueAtTime(0.05, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.05);
                    oscillator.start(audioCtx.currentTime);
                    oscillator.stop(audioCtx.currentTime + 0.05);
                    break;
                case 'success':
                    [523.25, 659.25, 783.99].forEach((freq, i) => {
                        const osc = audioCtx.createOscillator();
                        const gain = audioCtx.createGain();
                        osc.connect(gain);
                        gain.connect(audioCtx.destination);
                        osc.frequency.value = freq;
                        osc.type = 'sine';
                        gain.gain.setValueAtTime(0.1, audioCtx.currentTime + i * 0.1);
                        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + i * 0.1 + 0.2);
                        osc.start(audioCtx.currentTime + i * 0.1);
                        osc.stop(audioCtx.currentTime + i * 0.1 + 0.2);
                    });
                    break;
                case 'fail':
                    oscillator.frequency.value = 200;
                    oscillator.type = 'sawtooth';
                    gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                    oscillator.start(audioCtx.currentTime);
                    oscillator.stop(audioCtx.currentTime + 0.3);
                    break;
            }
        }

        // ==================== UI FUNCTIONS ====================
        function createBackgroundAnimation() {
            const container = document.getElementById('bgAnimation');
            for (let i = 0; i < 15; i++) {
                const ball = document.createElement('div');
                ball.className = 'basketball';
                ball.style.left = `${Math.random() * 100}%`;
                ball.style.animationDelay = `${Math.random() * 15}s`;
                ball.style.animationDuration = `${15 + Math.random() * 10}s`;
                container.appendChild(ball);
            }
        }

        function updateLevelLocks() {
            const level2Lock = document.getElementById('level2Lock');
            const level3Lock = document.getElementById('level3Lock');

            if (state.completedLevels.includes(1)) {
                level2Lock.classList.add('hidden');
            } else {
                level2Lock.classList.remove('hidden');
            }

            if (state.completedLevels.includes(2)) {
                level3Lock.classList.add('hidden');
            } else {
                level3Lock.classList.remove('hidden');
            }
        }

        function showStartScreen() {
            document.getElementById('startScreen').classList.remove('hidden');
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('resultsScreen').classList.add('hidden');
            updateLevelLocks();
            resetState();
        }

        function resetState() {
            state.currentRound = 0;
            state.score = 0;
            state.totalEV = 0;
            state.totalSurplus = 0;
            state.totalWindowFit = 0;
            state.selectedTrade = null;
            state.roundScores = [];
            clearInterval(state.timerInterval);
        }

        function startGame(level) {
            initAudio();

            // Check if level is locked
            if (level === 2 && !state.completedLevels.includes(1)) {
                alert('Complete Rookie GM first to unlock this level!');
                return;
            }
            if (level === 3 && !state.completedLevels.includes(2)) {
                alert('Complete Veteran GM first to unlock this level!');
                return;
            }

            resetState();
            state.currentLevel = level;

            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            document.getElementById('resultsScreen').classList.add('hidden');

            updateLevelDots();
            loadRound(0);
        }

        function updateLevelDots() {
            for (let i = 1; i <= 3; i++) {
                const dot = document.getElementById(`levelDot${i}`);
                dot.classList.remove('active', 'completed');

                if (i < state.currentLevel) {
                    dot.classList.add('completed');
                } else if (i === state.currentLevel) {
                    dot.classList.add('active');
                }
            }
        }

        function updateRoundDots() {
            for (let i = 1; i <= 3; i++) {
                const dot = document.getElementById(`roundDot${i}`);
                dot.classList.remove('active', 'completed');

                if (i <= state.currentRound) {
                    dot.classList.add('completed');
                } else if (i === state.currentRound + 1) {
                    dot.classList.add('active');
                }
            }
        }

        function loadRound(roundIndex) {
            const levelData = gameData.levels[state.currentLevel];
            const scenario = levelData.scenarios[roundIndex];

            state.currentRound = roundIndex;
            state.selectedTrade = null;
            state.timer = levelData.timer;

            // Update displays
            document.getElementById('levelDisplay').textContent = state.currentLevel;
            document.getElementById('roundDisplay').textContent = `${roundIndex + 1}/3`;
            document.getElementById('scoreDisplay').textContent = state.score.toFixed(1);
            document.getElementById('timerDisplay').textContent = state.timer;
            document.getElementById('timerDisplay').className = 'timer';

            updateRoundDots();

            // Update scenario
            document.getElementById('teamLogo').textContent = scenario.logo;
            document.getElementById('teamName').textContent = scenario.team;
            document.getElementById('teamRecord').textContent = `Record: ${scenario.record}`;
            document.getElementById('windowBadge').textContent = scenario.window;
            document.getElementById('windowBadge').className = `window-badge ${scenario.windowClass}`;
            document.getElementById('scenarioDesc').innerHTML = scenario.description;

            // Render trades
            renderTrades(scenario.trades, levelData.showScores);

            // Update button
            document.getElementById('confirmBtn').disabled = true;
            document.getElementById('confirmBtn').textContent = 'Select a Trade to Continue';

            // Start timer
            startTimer();
        }

        function renderTrades(trades, showScores) {
            const grid = document.getElementById('tradesGrid');
            grid.innerHTML = '';

            trades.forEach((trade, index) => {
                const card = document.createElement('div');
                card.className = `trade-card ${trade.typeClass}`;
                card.onclick = () => selectTrade(index);

                const scoreClass = showScores === false ? 'hidden-scores' : '';

                card.innerHTML = `
                    <div class="trade-type">
                        <div class="trade-type-icon">${trade.icon}</div>
                        ${trade.type}
                    </div>
                    <div class="trade-description">${trade.description}</div>
                    <div class="trade-scores ${scoreClass}">
                        <div class="score-box">
                            <div class="score-label">EV</div>
                            <div class="score-value ${getScoreClass(trade.ev)}">${showScores !== false ? trade.ev : '?'}</div>
                        </div>
                        <div class="score-box">
                            <div class="score-label">Surplus</div>
                            <div class="score-value ${getScoreClass(trade.surplus)}">${showScores === true ? trade.surplus : '?'}</div>
                        </div>
                        <div class="score-box">
                            <div class="score-label">Window</div>
                            <div class="score-value ${getScoreClass(trade.windowFit)}">${showScores === true ? trade.windowFit : '?'}</div>
                        </div>
                    </div>
                `;

                grid.appendChild(card);
            });
        }

        function getScoreClass(value) {
            if (value > 0) return 'positive';
            if (value < 0) return 'negative';
            return 'neutral';
        }

        function selectTrade(index) {
            state.selectedTrade = index;
            playSound('select');

            // Update UI
            const cards = document.querySelectorAll('.trade-card');
            cards.forEach((card, i) => {
                card.classList.toggle('selected', i === index);
            });

            document.getElementById('confirmBtn').disabled = false;
            document.getElementById('confirmBtn').textContent = 'Confirm Trade Decision ‚Üí';
        }

        function startTimer() {
            clearInterval(state.timerInterval);

            state.timerInterval = setInterval(() => {
                state.timer--;
                const timerEl = document.getElementById('timerDisplay');
                timerEl.textContent = state.timer;

                // Warning states
                if (state.timer <= 10) {
                    timerEl.className = 'timer critical';
                    playSound('tick');
                } else if (state.timer <= 20) {
                    timerEl.className = 'timer warning';
                }

                // Time's up
                if (state.timer <= 0) {
                    clearInterval(state.timerInterval);
                    if (state.selectedTrade === null) {
                        // Auto-select "Stay Put" (usually index 2)
                        state.selectedTrade = 2;
                    }
                    confirmTrade();
                }
            }, 1000);
        }

        function confirmTrade() {
            clearInterval(state.timerInterval);
            playSound('confirm');

            const levelData = gameData.levels[state.currentLevel];
            const scenario = levelData.scenarios[state.currentRound];
            const trade = scenario.trades[state.selectedTrade];

            // Calculate round score: EV + Surplus - (WindowFit * 0.25)
            // Higher WindowFit is good for win-now, bad for rebuild
            const windowMultiplier = scenario.windowClass === 'window-title' ? 0.5 :
                                    scenario.windowClass === 'window-push' ? 0.25 : -0.25;

            const roundScore = trade.ev + trade.surplus + (trade.windowFit * windowMultiplier);

            state.score += roundScore;
            state.totalEV += trade.ev;
            state.totalSurplus += trade.surplus;
            state.totalWindowFit += trade.windowFit;
            state.roundScores.push({
                round: state.currentRound + 1,
                trade: trade.type,
                ev: trade.ev,
                surplus: trade.surplus,
                windowFit: trade.windowFit,
                total: roundScore
            });

            // Next round or results
            if (state.currentRound < 2) {
                loadRound(state.currentRound + 1);
            } else {
                showResults();
            }
        }

        function showResults() {
            const levelData = gameData.levels[state.currentLevel];
            const passed = state.score >= levelData.passScore;

            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('resultsScreen').classList.remove('hidden');

            // Determine grade
            let grade, gradeClass;
            if (state.score >= levelData.passScore * 1.5) {
                grade = 'S'; gradeClass = 'grade-s';
            } else if (state.score >= levelData.passScore * 1.2) {
                grade = 'A'; gradeClass = 'grade-a';
            } else if (state.score >= levelData.passScore) {
                grade = 'B'; gradeClass = 'grade-b';
            } else if (state.score >= levelData.passScore * 0.7) {
                grade = 'C'; gradeClass = 'grade-c';
            } else {
                grade = 'F'; gradeClass = 'grade-f';
            }

            document.getElementById('resultsTitle').textContent =
                passed ? `Level ${state.currentLevel} Complete!` : 'Not Quite...';
            document.getElementById('resultGrade').textContent = grade;
            document.getElementById('resultGrade').className = `result-grade ${gradeClass}`;
            document.getElementById('resultsMessage').textContent =
                passed ? `Outstanding GM work! You've proven your skills at the ${levelData.name} level.` :
                `You needed ${levelData.passScore} points to pass. Try again!`;

            // Breakdown
            const breakdown = document.getElementById('resultBreakdown');
            breakdown.innerHTML = `
                <div class="breakdown-item">
                    <div class="breakdown-label">Total Score</div>
                    <div class="breakdown-value" style="color: ${passed ? 'var(--accent)' : '#e74c3c'}">${state.score.toFixed(1)}</div>
                </div>
                <div class="breakdown-item">
                    <div class="breakdown-label">Passing Score</div>
                    <div class="breakdown-value">${levelData.passScore}</div>
                </div>
                <div class="breakdown-item">
                    <div class="breakdown-label">Total EV</div>
                    <div class="breakdown-value">${state.totalEV}</div>
                </div>
                <div class="breakdown-item">
                    <div class="breakdown-label">Total Surplus</div>
                    <div class="breakdown-value">${state.totalSurplus}</div>
                </div>
            `;

            // Feedback
            const feedbackContainer = document.getElementById('feedbackContainer');
            feedbackContainer.innerHTML = '';
            state.roundScores.forEach(rs => {
                const feedbackClass = rs.total >= 3 ? 'feedback-good' : rs.total >= 1 ? 'feedback-okay' : 'feedback-bad';
                feedbackContainer.innerHTML += `
                    <div class="feedback-message ${feedbackClass}">
                        <strong>Round ${rs.round}:</strong> You chose <strong>${rs.trade}</strong>.
                        Score: ${rs.total.toFixed(1)} (EV: ${rs.ev}, Surplus: ${rs.surplus}, Window: ${rs.windowFit})
                    </div>
                `;
            });

            // Claim code
            const claimContainer = document.getElementById('claimCodeContainer');
            if (passed) {
                claimContainer.classList.remove('hidden');
                document.getElementById('claimCode').textContent = levelData.claimCode;

                // Save completion
                if (!state.completedLevels.includes(state.currentLevel)) {
                    state.completedLevels.push(state.currentLevel);
                    localStorage.setItem('completedLevels', JSON.stringify(state.completedLevels));
                }

                playSound('success');
                createConfetti();
            } else {
                claimContainer.classList.add('hidden');
                playSound('fail');
            }

            // Next level button
            const nextBtn = document.getElementById('nextLevelBtn');
            if (passed && state.currentLevel < 3) {
                nextBtn.classList.remove('hidden');
                nextBtn.textContent = `Start Level ${state.currentLevel + 1} ‚Üí`;
            } else if (passed && state.currentLevel === 3) {
                nextBtn.classList.remove('hidden');
                nextBtn.textContent = 'üèÜ You Are a Champion GM!';
                nextBtn.onclick = showStartScreen;
            } else {
                nextBtn.classList.remove('hidden');
                nextBtn.textContent = 'Try Again';
                nextBtn.onclick = () => startGame(state.currentLevel);
            }
        }

        function goToNextLevel() {
            if (state.currentLevel < 3) {
                startGame(state.currentLevel + 1);
            }
        }

        function copyClaimCode() {
            const code = document.getElementById('claimCode').textContent;
            navigator.clipboard.writeText(code).then(() => {
                const el = document.getElementById('claimCode');
                const original = el.textContent;
                el.textContent = 'COPIED!';
                setTimeout(() => el.textContent = original, 1500);
            });
        }

        function createConfetti() {
            const colors = ['#ff6b35', '#ffd700', '#00d4aa', '#004e89', '#ff4444'];
            for (let i = 0; i < 100; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = `${Math.random() * 100}%`;
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                    document.body.appendChild(confetti);

                    setTimeout(() => confetti.remove(), 3000);
                }, i * 30);
            }
        }

        // Sound toggle
        document.getElementById('soundToggle').onclick = function() {
            state.soundEnabled = !state.soundEnabled;
            this.textContent = state.soundEnabled ? 'üîä' : 'üîá';
            if (state.soundEnabled) initAudio();
        };

        // ==================== INIT ====================
        document.addEventListener('DOMContentLoaded', () => {
            createBackgroundAnimation();
            updateLevelLocks();
        });
    </script>
</body>
</html>
